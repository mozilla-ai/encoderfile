syntax = "proto3";

package encoderfile;

service EncoderFile {
  rpc Embedding(EmbeddingRequest) returns (EmbeddingResponse);
  rpc SequenceClassification(SequenceClassificationRequest) returns (SequenceClassificationResponse);
}

message SequenceClassificationRequest {
  string request_id = 1;
  repeated string inputs = 2;
  map<string, string> metadata = 3;
}

message SequenceClassificationResponse {
  string request_id = 1;
  repeated SequenceClassificationResult results = 2;
  map<string, string> metadata = 3;
}

message SequenceClassificationResult {
  repeated float logits = 1;
  repeated float scores = 2;
  uint32 predicted_index = 3;
  optional string predicted_label = 4;
}

message EmbeddingRequest {
  string request_id = 1;
  repeated string inputs = 2;
  bool normalize = 3;
  bool return_tokens = 4;
  map<string, string> metadata = 5;
}

message EmbeddingResponse {
  string request_id = 1;
  // len(embeddings) == len(inputs)
  repeated TokenEmbedding embeddings = 2;
  uint32 dim = 3;
  map<string, string> metadata = 4;
}

message TokenEmbedding {
  repeated float embedding = 1;
  optional TokenInfo token_info = 2;
}

message TokenInfo {
  string token = 1;
  uint32 token_id = 2;
  uint32 start = 3;
  uint32 end = 4;
}
